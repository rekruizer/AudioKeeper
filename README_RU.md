# AudioKeeper

Приложение для macOS в строке меню, которое удерживает ваши предпочитаемые аудиоустройства ввода/вывода. Автоматически восстанавливает выбранные устройства при изменении системных настроек по умолчанию (обычно при подключении новых устройств).

## Возможности

- **Интеграция в строку меню**: Чистая иконка в строке меню с легким доступом к настройкам
- **Автоматическое управление устройствами**: Отслеживает изменения аудиоустройств системы и восстанавливает ваши предпочтения
- **Удобный интерфейс**: Простой переключатель для включения/выключения и выбора устройств
- **Сохранение настроек**: Запоминает ваши предпочтения между запусками приложения
- **Интеграция с системой**: Уважает ручные изменения в Системных настройках

## Требования

- macOS 13.0 или новее
- Аудиоустройства ввода/вывода

## Установка

### Для пользователей

1. **Скачайте** последний релиз с [GitHub Releases](https://github.com/rekruizer/AudioKeeper/releases)
2. **Установите** AudioKeeper.app в Applications
3. **Запустите** и найдите иконку наушников в строке меню
4. **Настройте** предпочитаемые устройства ввода/вывода
5. **Наслаждайтесь** автоматическим управлением аудиоустройствами!

#### ⚠️ Установка без сертификата разработчика

Поскольку приложение не подписано сертификатом Apple Developer, вам нужно разрешить его запуск:

**Способ 1: Правый клик (Рекомендуется)**
1. Скачайте DMG с [Releases](https://github.com/rekruizer/AudioKeeper/releases)
2. Откройте DMG и перетащите AudioKeeper.app в Applications
3. **Щелкните правой кнопкой** на AudioKeeper.app в Applications
4. Выберите **"Открыть"** из контекстного меню
5. Нажмите **"Открыть"** в диалоге безопасности

**Способ 2: Через Terminal**
```bash
# После установки приложения выполните эту команду:
sudo xattr -d com.apple.quarantine /Applications/AudioKeeper.app
```

**Способ 3: Через Системные настройки**
1. Перейдите в **Системные настройки** → **Конфиденциальность и безопасность**
2. Нажмите **"Разрешить в любом случае"** рядом с сообщением о заблокированном приложении
3. Попробуйте открыть приложение снова

### Из исходного кода

1. Клонируйте или скачайте этот репозиторий
2. Откройте `AudioKeeper.xcodeproj` в Xcode
3. Соберите и запустите проект (`Cmd + R`)

### Сборка для распространения

Для продакшн сборки:

```bash
cd Scripts
./build_release.sh
```

Это создаст `AudioKeeper.app`, готовый для распространения.

## Использование

1. **Запустите приложение** - вы увидите иконку наушников в строке меню
2. **Кликните на иконку** для открытия меню настроек
3. **Включите приложение** с помощью переключателя "Активно"
4. **Выберите предпочитаемые устройства** для ввода и вывода
5. **Приложение автоматически восстановит эти устройства** при их изменении системой

## Как это работает

AudioKeeper использует CoreAudio API для:
- Мониторинга изменений аудиоустройств системы
- Обнаружения подключения новых устройств
- Автоматического восстановления предпочитаемых устройств
- Сохранения ваших настроек

## Настройка

### Bundle Identifier
Перед распространением обновите Bundle Identifier в `Info.plist`:
```xml
<key>CFBundleIdentifier</key>
<string>com.yourcompany.audiokeeper</string>
```

### Подпись кода
Настройте подпись кода в Xcode:
1. Выберите проект в Xcode
2. Target → AudioKeeper → Signing & Capabilities
3. Выберите вашу команду разработки

## Сборка для распространения

1. **Настройте Bundle Identifier** (см. выше)
2. **Настройте подпись кода** в Xcode
3. **Соберите релизную версию**:
   ```bash
   cd Scripts
   ./build_release.sh
   ```
4. **Создайте DMG установщик** (опционально):
   ```bash
   cd Scripts
   ./create_dmg.sh
   ```

## Структура проекта

```
AudioKeeper/
├── Sources/           # Исходный код Swift
│   ├── App/          # Основные файлы приложения
│   ├── Audio/        # Управление аудиоустройствами
│   └── Models/       # Модели данных и настройки
├── Assets.xcassets/  # Иконки и ресурсы приложения
├── Documentation/    # Файлы документации
├── Scripts/         # Скрипты сборки и распространения
├── AudioKeeper.xcodeproj  # Файл проекта Xcode
├── Info.plist       # Конфигурация приложения
├── README.md        # Английская документация
└── README_RU.md     # Русская документация
```

## Разработка

### Основные компоненты

- **AudioKeeperApp.swift**: Главная точка входа SwiftUI приложения
- **AppDelegate.swift**: Управление состоянием приложения и интерфейс меню
- **AudioDeviceMonitor.swift**: Мониторинг изменений аудиоустройств через CoreAudio
- **AudioSwitcher.swift**: Управление и контроль аудиоустройств
- **Preferences.swift**: Сохранение пользовательских настроек

### Добавление функций

Приложение спроектировано для легкого расширения:
- Добавляйте новые свойства аудиоустройств в `AudioSwitcher.swift`
- Расширяйте интерфейс меню в `AppDelegate.swift`
- Добавляйте новые настройки в `Preferences.swift`

## Устранение неполадок

### Частые проблемы

1. **Приложение не переключает устройства**
   - Проверьте, что приложение активно (переключатель в меню)
   - Убедитесь в наличии разрешений на аудио в Системные настройки → Конфиденциальность и безопасность

2. **Приложение не запускается**
   - Убедитесь, что подпись кода настроена
   - Проверьте уникальность Bundle Identifier

3. **Иконка не отображается**
   - Убедитесь, что иконки приложения правильно настроены в Xcode
   - Проверьте конфигурацию Assets.xcassets

## Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для функции
3. Внесите изменения
4. Тщательно протестируйте
5. Отправьте pull request

## Лицензия

Этот проект доступен под лицензией MIT. Подробности см. в файле LICENSE.

## Поддержка

По вопросам и проблемам:
- Проверьте раздел устранения неполадок выше
- Изучите документацию в папке `Documentation/`
- Создайте issue в репозитории проекта

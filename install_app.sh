#!/bin/bash

echo "üéß AudioKeeper - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
echo "======================================"

# –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
LATEST_APP=$(find ~/Library/Developer/Xcode/DerivedData -name "AudioKeeper.app" -type d -exec stat -f "%m %N" {} \; | sort -nr | head -1 | cut -d' ' -f2-)

if [ -z "$LATEST_APP" ]; then
    echo "‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ AudioKeeper.app –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!"
    echo "üí° –°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Xcode (Cmd + R)"
    exit 1
fi

echo "üìç –ù–∞–π–¥–µ–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: $LATEST_APP"
echo "üìè –†–∞–∑–º–µ—Ä: $(du -sh "$LATEST_APP" | cut -f1)"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Applications
if [ -d "/Applications/AudioKeeper.app" ]; then
    echo "‚ö†Ô∏è  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ /Applications/"
    read -p "–ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "‚ùå –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞"
        exit 0
    fi
    echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
    rm -rf "/Applications/AudioKeeper.app"
fi

# –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "üì¶ –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ /Applications/..."
cp -R "$LATEST_APP" "/Applications/"

if [ $? -eq 0 ]; then
    echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!"
    echo ""
    echo "üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ:"
    echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ /Applications/AudioKeeper.app"
    echo "2. –ò–ª–∏ –Ω–∞–π–¥–∏—Ç–µ –∏–∫–æ–Ω–∫—É –Ω–∞—É—à–Ω–∏–∫–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ –º–µ–Ω—é"
    echo "3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ –∞—É–¥–∏–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"
    echo ""
    echo "üí° –î–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:"
    echo "   System Settings ‚Üí General ‚Üí Login Items ‚Üí –î–æ–±–∞–≤—å—Ç–µ AudioKeeper"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
    exit 1
fi
